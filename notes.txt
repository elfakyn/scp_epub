- refactor to pkgutil.get_data
- bs4


Elements we definitely don't want:
* class = page-rate-widget-box
* class = heritage-rating-module (this one aligns to right, nope)
* class = footer-wikiwalk-nav


For local links:
* WIKIDOT DOCS: the site-unix-name consists of only alphanumeric characters (0..9, 'a'..'z') and ('-')
* local links will match regex ^\/[a-z0-9\-]+$
* todo: test for it

PAGE EDGE CASES:
	* scp-3125: has weird obfuscated text content on part of it. But there's a noninteractive bit.
	* pages embedding other pages using ListPages
		* how to tell: has "[[module ListPages ...]] ... %%content%% ... [[/module]]" in the "content" attribute.
		* some SCPs have this as a gimmick.
		* many hubs use this.
	* pages with blank or very short HTML

COMPONENTS:

[DONE] 0. download all pages
	[DONE] * downloader with cache support
	[DONE] * also download fragments

1. SELECT AND PRE-PROCESS PAGES
	[DONE] * FILTER LIST OF PAGES: ONLY USE tagged 'scp', 'tale', or 'hub'.
	* ADD PROPERTY: pages with ListPages that embed full contents of fragments, add an "embeds" key with value an array of embedded content pages in order.
		* this won't cover all gimmicks but should get most of them
		* log these pages
	* ADD PROPERTY: "embeds" for edge cases (keep manual mapping of edge case into embeds):
		* scp-3125
	* ADD FRAGMENTS FROM ABOVE TO LIST OF PAGES.

2. PRETTIFY PAGES
	* empty divs: delete
		* specifically the div that aligns to right, eff that div
    * rating box: delete
	* navigation footer: delete
	* images: delete
	* yui-navset: delete yui-nav, unwrap, prettify table, give specific class for CSS
	* collapsible block: link becomes title which is added as a text, content gets unwrapped, give specific class for CSS
	* footnotes: there's footnoteref and footnote-footer, make something nice and ebook friendly, give specific class for CSS
	* block quotes: give it a specific class for CSS
	* links: make local links redirect to correct page (/whatever -> whatever.xhtml), all other links deleted
	* how in the fuck to deal with interactive pages?
		* IGNORE ALL INTERACTIVITY
	* ADD NEW STUFF:
		* title add at beginning as <p> block, give specific class for CSS
	* ALLOW FOR ERRORS: some pages are completely blank or have fucked up html.

3. POST-PROCESS PAGES
	* DISCARD pages that BOTH do not have content AND do not have embeds
		* this will nuke some gimmicks such as pages using the CountPages module
		* log discarded pages7

4. ARRANGE BOOK (use this for TOC), USE THIS ORDER. NOTE: if a page contains embeds, add corresponding pages immediately after the parent page. Individual pages do not have an entry in the TOC.
	* FOREWORD ON DIGITAL EDITION
	* TOC
	* INTRO
	* HUBS
		* SCPS BY SERIES
			* (no toc) SERIES 1 scps, SERIES 2 scps...
			* (no toc) SERIES 1 tales, SERIES 2 tales, ...
		* all other hubs alphabetically
			* (no toc) list here
	* SCP SERIES 1
		* 1-100
			* (no toc) 1
			* (no toc) 2
			* ...
		* 101-200
		* ...
	* SCP SERIES 2
	* TALES 0-9
	* TALES A
		* (no toc): tales go here
	* TALES B
	* ...
	* ALPHABETICAL INDEX (make sure numbers are numeric not lexicographical)
	* CREDITS
3. add book metadata, 
	* title, authors etc.
	* cover photo
	* CSS
		* fix weird right align if not already fixed

===================
Long-term: 
 * add support for images
 * better support for ListPages and other interactive content.
 * option for smaller books